<h1 class="page-title">Order <%= order.orderId %></h1>

<div class="order-detail-container">

  <!-- ====================
       ITEMS (FULL WIDTH)
  ===================== -->
  <div class="order-card items-card">
    <h2 class="card-title">Items</h2>

    <!-- TABLE HEADER -->
    <div class="item-header-row">
      <span class="header-product">Product</span>
      <span class="header-price">Price</span>
      <span class="header-qty">Quantity</span>
      <span class="header-total">Total</span>
    </div>

    <% order.items.forEach(item => { %>
      <div class="item-row-modern">

        <!-- PRODUCT COLUMN -->
        <div class="col-product">
          <img class="item-image"
               src="<%= item.imageUrl || '/images/placeholder-shoe.jpg' %>"
               alt="<%= item.name %>">

          <div class="product-info">
            <p class="product-name"><%= item.name %></p>
            <p class="product-meta">
              <%= item.brand %> · Size <%= item.size || 'N/A' %>
            </p>
          </div>
        </div>

        <!-- PRICE COLUMN -->
        <div class="col-price">
          ₱<%= item.price.toFixed(2) %>
        </div>

        <!-- QUANTITY COLUMN -->
        <div class="col-qty">
          <%= item.quantity %>
        </div>

        <!-- TOTAL COLUMN -->
        <div class="col-total">
          ₱<%= item.subtotal.toFixed(2) %>
        </div>

      </div>
    <% }) %>

  </div>


  <!-- ================================
        SHIPPING + ORDER SUMMARY ROW
  ================================= -->
  <div class="info-summary-row">

    <!-- SHIPPING (LEFT) -->
    <div class="merged-card">
      <h2 class="card-title">Shipping Information</h2>

      <div class="shipping-row"><strong>Name:</strong> <%= order.shipping.fullName %></div>
      <div class="shipping-row"><strong>Address:</strong>
        <%= order.shipping.addressLine1 %>,
        <%= order.shipping.addressLine2 %>
      </div>
      <div class="shipping-row"><strong>City:</strong> <%= order.shipping.city %></div>
      <div class="shipping-row"><strong>Region:</strong> <%= order.shipping.region %></div>
      <div class="shipping-row"><strong>Postal Code:</strong> <%= order.shipping.postalCode %></div>
      <div class="shipping-row"><strong>Phone:</strong> <%= order.shipping.phone %></div>
    </div>

    <!-- SUMMARY (RIGHT) -->
    <div class="merged-card">
      <h2 class="card-title">Order Summary</h2>

      <div class="summary-row">
        <span>Status:</span>
        <strong><%= order.status.replace(/_/g, " ").replace(/\b\w/g, c => c.toUpperCase()) %></strong>
      </div>

      <div class="summary-row">
        <span>Placed On:</span>
        <strong><%= order.createdAt.toLocaleString() %></strong>
      </div>

      <div class="summary-row">
        <span>Total Items:</span>
        <strong><%= order.totalQty %></strong>
      </div>

      <div class="summary-row total-amount">
        <span>Total Amount:</span>
        <strong>₱<%= order.totalAmount.toFixed(2) %></strong>
      </div>
    </div>

  </div>

  <!-- ================================
        ADMIN ORDER STATUS UPDATE
  ================================= -->
  <% if (user && user.role === 'admin') { %>
    <div class="admin-update-card">

      <h2 class="card-title">Update Order Status</h2>

      <form method="POST" action="/admin/orders/update/<%= order.orderId %>" class="update-status-form">

        <label for="status">Select new status:</label>
        <select name="status" id="status" required>
          <option value="to_pay" <%= order.status === "to_pay" ? "selected" : "" %>>To Pay</option>
          <option value="to_ship" <%= order.status === "to_ship" ? "selected" : "" %>>To Ship</option>
          <option value="to_receive" <%= order.status === "to_receive" ? "selected" : "" %>>To Receive</option>
          <option value="completed" <%= order.status === "completed" ? "selected" : "" %>>Completed</option>
          <option value="refund" <%= order.status === "refund" ? "selected" : "" %>>Refund</option>
          <option value="cancelled" <%= order.status === "cancelled" ? "selected" : "" %>>Cancelled</option>
        </select>

        <button type="submit" class="btn-primary update-btn">Update Status</button>
      </form>
    </div>
  <% } %>

</div>

<div class="dashboard-actions">
  <% if (user && user.role === 'admin') { %>
    <a href="/admin/orders" class="btn-back">Back to Orders</a>
  <% } else { %>
    <a href="/orders" class="btn-back">Back to Orders</a>
  <% } %>
</div>
