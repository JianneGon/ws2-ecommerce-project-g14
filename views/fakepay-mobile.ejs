<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GCash Demo Payment</title>

<!-- Prevent scaling + ensure clean mobile rendering -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<style>
  /* ==========================================================
     FORCE ISOLATION — Hide header/footer if ever injected
  ========================================================== */
  header, footer, nav, .navbar, .footer {
    display: none !important;
  }

  /* ==========================================================
     BASE STYLES — No inheritance from your site
  ========================================================== */
  body {
    margin: 0;
    padding: 0;
    background: #0b1726;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    color: #fff;
    height: 100vh;
    overflow: hidden;

    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* ==========================================================
     GCASH MOBILE CARD UI
  ========================================================== */
  .gcash-shell {
    width: 100%;
    max-width: 380px;
    background: #111b2f;
    border-radius: 28px;
    padding: 32px 26px 36px;
    box-shadow: 0 12px 38px rgba(0,0,0,0.55);
    animation: fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(14px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .gcash-header {
    text-align: center;
    margin-bottom: 22px;
  }

  .gcash-header-title {
    font-size: 1.05rem;
    font-weight: 700;
  }

  .gcash-subtitle {
    color: #9fb1d4;
    font-size: 0.8rem;
  }

  /* Amount Section */
  .gcash-amount {
    text-align: center;
    margin: 24px 0 16px;
  }

  .gcash-amount-label {
    font-size: 0.85rem;
    color: #a9b4d4;
  }

  .gcash-amount-value {
    font-size: 2rem;
    font-weight: 700;
    margin-top: 6px;
  }

  /* Merchant Section */
  .gcash-merchant {
    text-align: center;
    font-size: 0.9rem;
    color: #a9b4d4;
    margin-bottom: 10px;
  }

  .gcash-merchant strong {
    color: #fff;
  }

  /* PAY BUTTON */
  .gcash-btn {
    margin-top: 32px;
    width: 100%;
    border: none;
    border-radius: 999px;
    padding: 14px 0;
    font-size: 1rem;
    font-weight: 600;
    background: #2ecc71;
    color: #fff;
    cursor: pointer;
    transition: 0.25s ease;
  }

  .gcash-btn:active {
    transform: scale(0.97);
    background: #27ae60;
  }

  /* Status */
  .gcash-status {
    margin-top: 18px;
    text-align: center;
    font-size: 0.85rem;
    color: #a9b4d4;
  }

  /* Success Icon */
  .gcash-check {
    font-size: 2.8rem;
    margin-bottom: 10px;
    animation: pop 0.35s ease-out;
  }

  @keyframes pop {
    0%   { transform: scale(0.3); opacity: 0; }
    60%  { transform: scale(1.2); opacity: 1; }
    100% { transform: scale(1); }
  }
</style>
</head>

<body>

  <div class="gcash-shell" id="gcashShell">

    <!-- Header -->
    <div class="gcash-header">
      <div class="gcash-header-title">GCash Payment</div>
      <div class="gcash-subtitle">Continue with the payment once you’ve reviewed the amount.</div>
    </div>

    <!-- Amount -->
    <div class="gcash-amount">
      <div class="gcash-amount-label">Amount to Pay</div>
      <div class="gcash-amount-value">
        ₱<%= Number(order.totalAmount).toLocaleString() %>
      </div>
    </div>

    <!-- Merchant -->
    <div class="gcash-merchant">
      Paying <strong>Commonwealth Demo Store</strong><br>
      Order <strong><%= order.orderId %></strong>
    </div>

    <!-- Pay Button -->
    <button id="payBtn" class="gcash-btn">Pay Now</button>

    <div id="gcashStatus" class="gcash-status">
      Once the payment is completed, you may return to your browser to continue.
    </div>

  </div>

<script>
  const payBtn = document.getElementById("payBtn");
  const statusEl = document.getElementById("gcashStatus");
  const shell = document.getElementById("gcashShell");

  payBtn.addEventListener("click", async () => {
    payBtn.disabled = true;
    payBtn.textContent = "Processing...";

    try {
      const res = await fetch("/orders/pay/mobile/<%= order.orderId %>/confirm", {
        method: "POST"
      });

      const data = await res.json();

      if (data && data.success) {
        shell.innerHTML = `
          <div class="gcash-header">
            <div class="gcash-check">✅</div>
            <div class="gcash-header-title">Payment Successful</div>
          </div>

          <div class="gcash-amount">
            <div class="gcash-amount-label">Paid Amount</div>
            <div class="gcash-amount-value">
              ₱<%= Number(order.totalAmount).toLocaleString() %>
            </div>
          </div>

          <div class="gcash-status">
            You may now return to your laptop.<br>
            The page will redirect automatically.
          </div>
        `;
      } else {
        payBtn.disabled = false;
        payBtn.textContent = "Pay Now";
        statusEl.textContent = "Something went wrong. Try again.";
      }

    } catch (e) {
      payBtn.disabled = false;
      payBtn.textContent = "Pay Now";
      statusEl.textContent = "Network error. Try again.";
    }
  });
</script>

</body>
</html>
